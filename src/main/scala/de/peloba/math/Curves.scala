/**
 * The peloba zero-knowledge library
 * Copyright (C) 2013 peloba UG & Co. KG
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as
 * published by the Free Software Foundation, either version 3 of the
 * License, or (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */
package de.peloba
package math

import it.unisa.dia.gas.plaf.jpbc.pairing.{CurveParams, PairingFactory}
import java.io.ByteArrayInputStream
import collection.mutable

/**
 * The class Curves contains the descriptions of the curves currently supported by the library.
 * All curves are MNT curves
 *
 * The class contains a static hash map '''Map''' that maps strings to curve descriptions. The map is mostly used
 * internally. The important part of this class is the textual description that serves as input to the
 * CommonReferenceString class.
 *
 * Currently, the following curves are supported supported are:
 * - typeD_224_496659: 112 bit security, included in the original pbc package
 * - typeD_130_139051: 65 bit security, use for testing only
 * - typeD_161_1: 80 bit security, use for low-security applications only
 * - typeD_161_2: 80 bit security, use for low-security applications only
 * - typeD_224_2: 112 bit security
 * - typeD_247_1: 123 bit security
 * - typeD_247_2: 123 bit security
 * - typeD_254: 126 bit security
 * - typeD_260: 130 bit security
 * - typeD_509: 254 bit security
 * - typeD_514: 257 bit security
 * - typeD_512: 256 bit security
 * - typeD_30: 15 bit security, use for testing only
 * - typeD_42: 21 bit security, use for testing only
 *
 * Notice that due to the structure of the elliptic curves, it is sometimes the case that curves with a higher security parameter
 * are faster than curves with a smaller security parameter.
 *
 * @author Julian Backes
 * @author Stefan Lorenz
 * @author Kim Pecina
 */
object Curves {
	private val curves = mutable.HashMap(
		"typeD_224_496659" -> "type d\nq 15028799613985034465755506450771565229282832217860390155996483840017\nn 15028799613985034465755506450771561352583254744125520639296541195021\nh 1\nr 15028799613985034465755506450771561352583254744125520639296541195021\na 4651032277610786673089510188312145304420972669600002333563057059292\nb 2979734258888211456760334675803381117924509496941700076657046758620\nk 6\nnk 11522474695025217370062603013790980334538096429455689114222024912184432319228393204650383661781864806076247259556378350541669994344878430136202714945761488385890619925553457668158504202786580559970945936657636855346713598888067516214634859330554634505767198415857150479345944721710356274047707536156296215573412763735135600953865419000398920292535215757291539307525639675204597938919504807427238735811520\nhk 51014915936684265604900487195256160848193571244274648855332475661658304506316301006112887177277345010864012988127829655449256424871024500368597989462373813062189274150916552689262852603254011248502356041206544262755481779137398040376281542938513970473990787064615734720\ncoeff0 374024772661481456462710898576929464775168018677476721255257019463\ncoeff1 3467236668578165087952344962705310430643028949290758173088209674968\ncoeff2 2943934211917487697871414934727137532293773392387846895364161954536\nnqr 2323545594553486824902487469272781494413384247638898596648764903196".getBytes,
		"typeD_130_139051" -> "type d\nq 8695269807063335217764727240823496250257\nn 8695269807063335217857975671411165312741\nh 7\nr 1242181401009047888265425095915880758963\na 6460130081821632233704516711295913469462\nb 1408330118859976416548102060589443562889\nk 6\nnk 432213546108533308337941951568279010408648389625209759489034558928540190613310379568802876062166436677923737618058743888240969720290432660770316670381452143550279579202078977971657917440521746901170264132800966444923221371187972076229323200\nhk 280109816758262468089829112186204110793124812939315563157309751866723078694348952360664946934842753915163398648724697163357111895266865581186660647637873781412800\ncoeff0 8128689017692053983768963091450777747691\ncoeff1 5125258832157687285297071781244816445031\ncoeff2 5241667627781820987210646520031013545161\nnqr 7709806221819211857306380295215340200657".getBytes,
		"typeD_30" -> "type d\nq 307552321477\nn 307552876051\nh 397\nr 774692383\na 57938748681\nb 87909218568\nk 6\nnk 846279960613857163677994441407575525612534010977441859851462511752640\nhk 1410118094382593583477307178776301134900684553741760\ncoeff0 73039094775\ncoeff1 104647496648\ncoeff2 45931306246\nnqr 65756365958".getBytes,
		"typeD_42" -> "type d\nq 15601244036403601\nn 15601243911498661\nh 4069\nr 3834171519169\na 7250090308816147\nb 10033808218011965\nk 6\nnk 14419671980087101220496895600910520428582891512408583583597848352141311295584672963387596406731200\nhk 980871932434523347853552262815971870339326329633045929653868960914379200\ncoeff0 8220436261183114\ncoeff1 11880775864736561\ncoeff2 5491505033777734\nnqr 3026432627299699".getBytes,
		"typeD_161_1" -> "type d\nq 1952401851632427368670162301493167584884422402501\nn 1952401851632427368670163698776908144555920604051\nh 1\nr 1952401851632427368670163698776908144555920604051\na 1490695612180133365871312921403974706404778505366\nb 1644597691997564700137596048100372332564659804411\nk 6\nnk 55387946645708705518155997944244214808683952696044973758335367626316359790705722926250046942969363419460563849371926137150515299951740523287022599590628799612734031498815296664027850004858445730890611702191887099560334214259308230878031029973008027036811832515755917391794870362885741080000\nhk 14530375693856415255521935547050997844607682118785613765197786278216594238962838827082737425046194622639708112749431966922192746572606405105580119826637719233154738965711916014574963091093080000\ncoeff0 1520902562155772431086481642521179301839511316131\ncoeff1 156198946816244472829386851945166007342166261467\ncoeff2 303425053785125054836340586626355720615778817466\nnqr 57084580934146355464509183624864818560165311912".getBytes,
		"typeD_161_2" -> "type d\nq 34155376728415643485253199952223120817480971620809317\nn 34155376728415643485253199767411387617406135340735963\nh 14079\nr 2425980306017163398341728799446792216592523285797\na 20312791012288149843963380388194236861411579708804784\nb 29193966895528922019328997894162889165304919414314292\nk 6\nnk 1587648945903454419702294240696669428988257567004066667807817123624472417955040581724182593942606411788830338483111739923094122455965212711863453680770344432635484301107088581083365986465995771210066008136141674961980627026805959407325799760861946153887760541539723935858058246026804124025609796222220660565141631296\nhk 269761481129543709905880358277500023395314481104084120305961073572355019695601034021874289343986546858568479155991309118249358857985438172361312160865276114790621806863462094233703391155493997120107408194663831963226944\ncoeff0 2295057014040029139783182191876637309999723705795876\ncoeff1 10612322798539224115003714892687326553245250422118744\ncoeff2 25812208468470580028915275751993080822340276369053172\nnqr 6944762381760004990714175030408289337497673785502111".getBytes,
		"typeD_224_2" -> "type d\nq 423950221963032735406632516664560368165536205107413149603815530494845552357\nn 423950221963032735406632516664560368186126256636319839919064032221101041423\nh 19179007\nr 22104909913377305478152884383668057902378692318967287509674720501489\na 144706485829240218388163228072392852011268849275106968263847369368650678267\nb 237787731207171057394319657603115357396024634552542362043836756410715636297\nk 6\nnk 5806162705808540421583116107706919888888699767724556505924436804210041262842857768786172853747819310414884803638691097404754058254762599996506595903667631747135775925895620947638823684313600010304773433045985845306149623555945255815793844697396727847125451454441386351195747694642386961391835156781295021824434637602526688845460925811014211145131405453514407627715257437538634135787974918600693481007961223017382631294225813744928413518217574950336\nhk 11882606166727306081669334853502245389136911192910744317634737699770987690497326316435234846062344511502677180779938134423557049911555342498941823596395533049825089877051160018184544784665902615014284223565213081221175208718528965974311316857709059517038235477237373459774795963699707539310670139072426624736468416\ncoeff0 330550216170549330005523532893158127954518422206692453177297810249699153300\ncoeff1 409161247536754291839030487230455848794209081225132411933291092513785583649\ncoeff2 228169852432602281523660773985342966817324956267652754705558902444851692873\nnqr 102830624468399912754089916194361939242334018530125104484461923549628831663".getBytes,
		"typeD_247_1" -> "type d\nq 3418932119321224598064399818982707994923125800013155050625048795004544321523300091110401\nn 3418932119321224598064399818982707994923125858484790219493249329741863255246041610581921\nh 29840527315741\nr 114573448489890590686211903198876999290478456547025187285699400381496240981\na 2843585618567244897698686966198909172394753252291170857729606339071900772345640041088356\nb 756079705937755065777658037805036783288793568189728888278054627713085741055993330355437\nk 6\nnk 1597139569212085150738187686937811903103306552325366412599258525854215457271594553993534807092731731768576525876678670183120586383038975821978000498247825265969889026191221386018877402980738994086850550554098262741160957994041286630695439750841143590038497489022561466809345055442892050434400869540935211653500929828735168682979701400932210562377704151370228271872090828310945176829543219365993698591115418922883196605334554706776681628685871909895916137961678007023463414867092448264594058512140683451834340936434845203148800\nhk 121667588338098511000658188491112334381593075615130020802774417203448269350563388975987721251761376062275337688837181172958904378222417957853765524410694006798236454855688268875176012456857319284868529957842288935178333562753716791717211005149156819284299721144096060589466208474585939488527009953143396200492886060328472299376859062599851797862961938765642921604071872211660800\ncoeff0 1969131672483721625705255741801294744596903659823422055725683548124119200860458345462888\ncoeff1 2838800424334096164345194888333222645227844523910893576076017859232702320454603727637274\ncoeff2 1132725257616297862049698272656965351279500594140346327473117399930930055566548711985468\nnqr 2210494750055939038039706229702967859364761450968761876432036251410404800231091273966362".getBytes,
		"typeD_247_2" -> "type d\nq 3474229583674585610243702312534454086163895548451593558458442547007421751292177\nn 3474229583674585610243702312534454086165759476986616987303380304613498460825453\nh 18291\nr 189942025240532809045087874503004433118241729647729319736667230037368020383\na 1748651965672133060243533533852480867205652486990722143464267078325933589728440\nb 1075681541226681370356355585044838282823924147417871409678353957177003685817022\nk 6\nnk 1758535274932713200154058556693689083408299103499745158883773711836099342312871762239178727447215656361580000435674734352015760785283575206408003733246461437449375611190332357224123103857224211915345952508729213476699302082705468862956472781879968227872421486003244734051113935014767333016708493060979877241580916812391541106493960724972983899950284712917333279440337073126506898016697116453404951443445571422837189957753232240201373050213745130695553108529852481633464256\nhk 48742629671827649363988461881859369903287577336754668815163047639106656141031499925924514510765410659771357670625868433764784168790664075203733211996787667767773292738880373317730048065134685644642736534757420828479808623871200372434183032826068667037713422903403650500778816446001626475222247828286090641105932991600877504\ncoeff0 2031595148228452885501688563647476684804944800538282140939927696111256387481693\ncoeff1 1772174742273895185776453065973623191004776363166145216654559567165915315281852\ncoeff2 115866171424699283069699695179671308170968508083535318358286212293800453447998\nnqr 1638338904060590315615778878486890173072887959304871299152851268413387677880176".getBytes,
		"typeD_254" -> "type d\nq 62115300874840720298726803315113867183997123139328801064173248613150347690767397\nn 62115300874840720298726803315113867184005004465414863023346874091052945255937311\nh 3819\nr 16264807770317025477540404114981373968055774932027981938556395415305824890269\na 42984075943635241739126451722799492291240722219517474308909324308453046502541098\nb 28656050629090161159417634481866328194160481479678316205939549538968697668360732\nk 6\nnk 57436975016412377535209774522192718952539319825739456627743307886248238599123329696537572293087819484150228722712405919470211290723211633065756729301707334378792242599237774469154105717673981110726590726079023899380523815323237797043959187695192322953703742071666015987833952135768003192548900163959099705031837074697754628356366990649491405543939663405952427333628695179432700365828253780114074128201916302692670643618260753887917499120851735953935911318186034305859934794022080\nhk 217116930030335039024717576321674937022116887414755870297186447174761678392273583072103610184901490103491538802539979971186736804962775001417738969584365943057677868279637047472530404455494416606594716781417816743209957797367159668873947051562772876541496294854532335456307366973184125271802391135183999568219179766518683801280\ncoeff0 4115073026159576624245340380848324153507730054088104662736287898997435785335551\ncoeff1 28001022598426139150234717433494915780149284912316437732509692804817360037829291\ncoeff2 24209239664480728238700919558082986100244672648812095856650933967442023411947080\nnqr 4422538867456674225709805481414996301204869977635957905780725774401292603359227".getBytes,
		"typeD_260" -> "type d\nq 4850460358657963210680295264221414976403518997053652810370664468910754520881027761015057\nn 4850460358657963210680295264221414976403518927408406320334008050579124027656750905508973\nh 2840279533\nr 1707740489026705672029463328256646975741003210407743455134776007477966791959681\na 994090585856972554965567860227380806586296419084616816758896299350694756021287070232012\nb 4367373205084487190013504667049809821022517240521702766795216272487810210469949306536625\nk 6\nnk 13022601691995365599119603754027504239919397954208855009776171023843355367192642329392336887637766606568407795235860823348884146555614068911730173264617672515136484713304935047604747861757447927884163129566905400492906496240731117760568541298280729569374089947911869708616369309756802521120427187754329004950973587460610195344529460796016599209129234177703156715052026666708367373154424975827535548605959649402083246084811612456904513655475136450542155288184654904348150992439777346955068834141937348106990321361763677289369536\nhk 4465334595510759959441247373742746537602651134533557919138808991634503439717521365947875727399651578225286621671969611781808502507815573436822309427410585482032463041420587122082905372093482960019886901827467953004925181917493145068810543698731626417212778763429983332666351910028608544572575508957910626845019456053850631467244490414679878278805807872861908138621603776\ncoeff0 3536212889113659779208993919923356317166148843633980288020646229491077667714781595479805\ncoeff1 3763166860436325269515933186699357104708996075861180255194846737479489188926416050506865\ncoeff2 4784976529086886361954092764114429196778326832752222711990808430083792200788273482099450\nnqr 2329662435541002968404388119584513307007034605206045889515915846333760478277977936917670".getBytes,
		"typeD_509" -> "type d\nq 1568433060842033418567039074326807814652244923064496424575877081617120087711145072676124876656086172898156884463110254644201042944605091450185088271023237\nn 1568433060842033418567039074326807814652244923064496424575877081617120087711105469228537046206971195581061091375516621593850720509783490639586783282674343\nh 1\nr 1568433060842033418567039074326807814652244923064496424575877081617120087711105469228537046206971195581061091375516621593850720509783490639586783282674343\na 1247648230154576794991400314735817303065481207542606199711019326490913371353022639290988974106878424492734504507557337745444108041037876432022253377995812\nb 831765486769717863327600209823878202043654138361737466474012884327275580902015092860659316071252282995156336338371558496962738694025250954681502251997208\nk 6\nnk 14886614051312240324167690031308776590574232798880290432590725823429307599995223203371169710613406885821801087260984655386533312651531381146345559411516399902282332533692824083098220231244814496924608848825488815386613246567738174687296269899680311230018071792880126755221376245531784313801505343849504816480601924010964494500146456821191992093903538336919861038555164715120421202428250426315830152951658757459793822836541334980886828197177289617158611128541542202040660879563135945068254965714138914432330262291932657447898044948509459595384367337955206498978004647497563247734735430370689824431432291596384822927070843732207443443487728838004005986068008991329946747423953984510944160612393293467902954080216322964854530376600959744108033495958668179475688075867898271143630842391194457489976532239548889207515186627174601011665466742219983897301075808628781975744575409783348349601428698409045456747044386361130206016\nhk 6051512750718646355409759555164798221257891748447076549305324340504893560408012619727965289781838178236468621280072959993165242577816885389303312377887487727268175852363736123972701207216088476532361387431353299564009182130617209347614738962459169727787239084230125238623318000182256909209933995672439419531419171155243218661795489302350552720478450553033025565322602979770531904513016626540164107310827831384240278535623337606083271270378476716247640291782189352055269700341009455944843257537062515483357672110601264941467033474922972649234737665741889993507153849531667531776687518376294169925073567440855627584\ncoeff0 968688966318413366108283825677596911538432628329356765701275108555146656236629856660865785997583137539212350911344690150494768662388717630722362643990144\ncoeff1 1224115896103243655973553241959401381551476633726676581749334630278001361960350817827689046005332834929008686393380301357650627692492141245883434966680670\ncoeff2 436670006510406696872857917279346176479782005225789980239082354509172351673432287616708172509421515195231578962892376423838940980904682557603620315091846\nnqr 134287100568355360387193151995303059859876586339995829565446070677696525165012088016439915315893917228987555133600022724595472571729176340458705926720089".getBytes,
		"typeD_514" -> "type d\nq 8119928374079253991185425926153258050977083573846617974041124280957494110686649403117001928185790126899721270225933747411506777383757461377406125687426801937\nn 8119928374079253991185425926153258050977083573846617974041124280957494110686652252665803770199162172399111096226930470181125756139260957556757669128734451893\nh 201\nr 40397653602384348214852865304245064930234246636052825741498130751032309008391304739630864528354040658702045254860350597916048538006273420680386413575793293\na 135988407886388971758848340383272361287299029084759820294598911890425191150614313980771366952161940376547874411206610737538085673018001514738198120627470379\nb 6006234378228870757910029113202257164497357929018169126977243243710808448201831052857949483233242464401618401866363365205666410059346246769213211959940118216\nk 6\nnk 286624420757452846547558592832616869656283939240260537419068534839356918415830784868522168268786772079423808689001962780393433348955025909417567681361729799442986515677684225398933753371340614624107124032571672397531412488938538167285468013854161792364109308742820830797767795795330376157496705933518223105692940847279700333811121067268966492159622547606615345605981769371637709185647063822387112314813555893132651180185523136161536288781129245463349304480122820767378455708758075160019130646238606251724310209580447179968928987434276353666446051254743451570657039114873335324473051407987787553063366187396885036547073580884953789266172119240387401053054946314057409497966308720447492248157818330586773437826623052817794792957208611954437923714947966810834207931332048132321027037813303362268796049914380175583620527064492679959499492502217590391028812907430562255457753649212536147686258969756380636130847254470248364644005408070285530977216\nhk 175630892475624722029922200934415512359104475739233334371977206507220809428247624320766256197617775327580483637697696705131017285779786328447303470129119833897812829959165929795020231939496884075153334937765270009534492854122884444264779586877345633080497422871675916170831657432180524496689676387720542015569427301850319459123180343763247038236957415590603967826189877568259892488880698012258908670943353374482488012348470119242023456958887102986493706114092802287874952885856638535585706440106189629665730766337767905914249043732651160429881452853481009544157461597483158233908106308242221606613751058530657019439061633366074101184\ncoeff0 6116656587559849067085887043426725062395051792384203623802076188331669835175780521243070460658879236411703223000525999824892324794860884854478188878010407995\ncoeff1 4276454904765738740804751853237194317158055406734555887257748952825401315429998126303901295847893624777994481914391966530936799693896117478625871203982556571\ncoeff2 3567824568778316685155562395755563564909258027553158370162766311267586458526773010642271130587740712088185312818733635695294754676112184914299007287934890293\nnqr 271108279378167148928261664958696919051055462447694299732491178617901789751087642393270147499059825140475823925893912916155626569240973969273584549278455562".getBytes,
		"typeD_512" -> "type d\nq 7896321949462550756625082609068222321141882447378114317307487871144815310210878940744349833876522579372006268093875232764682697652713145929232389089941137\nn 7896321949462550756625082609068222321141882447378114317307487871144815310210967801995463367894537558191978331547541125303762140773982196883541855012777693\nh 1\nr 7896321949462550756625082609068222321141882447378114317307487871144815310210967801995463367894537558191978331547541125303762140773982196883541855012777693\na 3164665641666670664366271342678020062127938277141399579447416865952954478181991245810015739002165876126392687650815687105097676671103885229009446315018473\nb 2109777094444447109577514228452013374751958851427599719631611243968636318787994163873343826001443917417595125100543791403398451114069256819339630876678982\nk 6\nnk 242409191272304705550527935508769205568538235024163860021134295392821069371731100354910844581561690863541752662094542711622133637448862385904104992959607990954277130213379613862172495810820255093607158427588719345712721173419884976248866511035626930759581536257507549178866911813390524486119143329513298125795362605612252388566138069723888602867997749289461548887197512820602997755994122430085326767729620026971452126968660218700766834671741418190351567850830138176684038998547213907756680820441840678189134008733948239095661207695041736811959731384736534155755274291451033989832139914046765094297091620749924126137616021636515613403299702194673324644892019968123326046601960367993381549372579489107563072022656092752543833383291521137748079836879753089639658912547639160739148827153079348037155851822730259682748539331404121604371115992558354506070396740737668757271637096434453544193150426707100538077014264135500721236416\nhk 3887759474707890482805252712931563542989068558901774609342134141706568699736575784432092704442457824424553329658231120827297357418012051537535172952024558887042815975291065585865742452235733825639951369269416236075531426844323653888948448661819834376895371947894954119039320008187073805112697232461781556162657475586594251744961740289829718414822428266813152170090621097367116641896960267357728640244583333371953134101480473541151124821906747622754267418936909780100338159581127463727336351522122005488985267087865903082588847817869909082349452427697746330815712896639694202180434145831119203305584355400742566427584\ncoeff0 4681807310436642999716196160866693271085261300396408995134268654106360416757974641721614353844345833905129152425311079887460956826528362451067270614484786\ncoeff1 3502149801966047881059107229571340335690922060669806382939783282227636963234000634314227399716690223168999951227919391687782770159760456960957968807886984\ncoeff2 3505241253294163220530842494299331218156570145544427560601913791903674880344868200754859301453717891132351755372519365132049383419968115080484646927230446\nnqr 389430178414372056222615675070485817173725664285939436449896315857302285013383764765836073567316880771532523257270838224151473547719964410015663800395266".getBytes
	)

	private val emptyByteArray = "".getBytes

	/**
	 * Adds a curve description to the internal curve hashmap
	 *
	 * @param curveKey Name of the curve to be used in the initialization of the CommonReferenceString
	 * @param curveDescription Textual description of the curve, see the libpbc documentation for more information
	 * @return unit
	 */
	def addCurve(curveKey: String, curveDescription: String) {
		curves.put(curveKey, curveDescription.getBytes)
	}

	/**
	 * Adds a curve description to the internal curve hashmap
	 *
	 * The byte array description should be obtained by taking a string description and calling the getBytes method on it.
	 *
	 * @param curveKey Name of the curve to be used in the initialization of the CommonReferenceString
	 * @param curveDescription Description of the curve in byte array form, see the libpbc documentation for more information
	 * @return unit
	 */
	def addCurve(curveKey: String, curveDescription: Array[Byte]) {
		curves.put(curveKey, curveDescription)
	}

	/**
	 * Returns a jpbc pairing object for the given curveKey
	 *
	 * The pairing object offers a direct access to the mathematical functionality of the bilinear map.
	 *
	 * @param curveKey The name of the curve
	 * @return The jpbc pairing object for the given curve key
	 */
	def pairing(curveKey: String) = {
		PairingFactory.getPairing((new CurveParams()).load(new ByteArrayInputStream(curves.getOrElse(curveKey, emptyByteArray))))
	}
}
